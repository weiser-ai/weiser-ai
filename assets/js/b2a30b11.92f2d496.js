"use strict";(self.webpackChunkdocusaurus=self.webpackChunkdocusaurus||[]).push([[603],{346:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>r,default:()=>h,frontMatter:()=>d,metadata:()=>i,toc:()=>a});const i=JSON.parse('{"id":"check-types/anomaly","title":"Anomaly Detection Check","description":"The anomaly check uses statistical methods to detect unusual patterns in your metrics over time. It employs Median Absolute Deviation (MAD) to identify values that deviate significantly from historical patterns.","source":"@site/docs/check-types/anomaly.md","sourceDirName":"check-types","slug":"/check-types/anomaly","permalink":"/docs/check-types/anomaly","draft":false,"unlisted":false,"tags":[],"version":"current","frontMatter":{},"sidebar":"tutorialSidebar","previous":{"title":"Not Empty Percentage Check","permalink":"/docs/check-types/not-empty-pct"}}');var t=s(4848),l=s(8453);const d={},r="Anomaly Detection Check",c={},a=[{value:"Configuration",id:"configuration",level:2},{value:"How It Works",id:"how-it-works",level:2},{value:"Examples",id:"examples",level:2},{value:"Basic Anomaly Detection",id:"basic-anomaly-detection",level:3},{value:"Strict Anomaly Detection",id:"strict-anomaly-detection",level:3},{value:"Relaxed Anomaly Detection",id:"relaxed-anomaly-detection",level:3},{value:"Getting Check IDs",id:"getting-check-ids",level:2},{value:"Statistical Method",id:"statistical-method",level:2},{value:"Median Absolute Deviation (MAD)",id:"median-absolute-deviation-mad",level:3},{value:"Modified Z-Score",id:"modified-z-score",level:3},{value:"Minimum Data Requirements",id:"minimum-data-requirements",level:2},{value:"Use Cases",id:"use-cases",level:2},{value:"Example Results",id:"example-results",level:2},{value:"Workflow Integration",id:"workflow-integration",level:2},{value:"Step 1: Set up base metric",id:"step-1-set-up-base-metric",level:3},{value:"Step 2: Run and collect data",id:"step-2-run-and-collect-data",level:3},{value:"Step 3: Add anomaly detection",id:"step-3-add-anomaly-detection",level:3},{value:"Threshold Guidelines",id:"threshold-guidelines",level:2},{value:"Limitations",id:"limitations",level:2},{value:"Best Practices",id:"best-practices",level:2},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"Insufficient Data",id:"insufficient-data",level:3},{value:"Check ID Not Found",id:"check-id-not-found",level:3},{value:"All Values Flagged",id:"all-values-flagged",level:3},{value:"Related Checks",id:"related-checks",level:2}];function o(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"anomaly-detection-check",children:"Anomaly Detection Check"})}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"anomaly"})," check uses statistical methods to detect unusual patterns in your metrics over time. It employs Median Absolute Deviation (MAD) to identify values that deviate significantly from historical patterns."]}),"\n",(0,t.jsx)(n.h2,{id:"configuration",children:"Configuration"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Parameter"}),(0,t.jsx)(n.th,{children:"Required"}),(0,t.jsx)(n.th,{children:"Description"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"name"})}),(0,t.jsx)(n.td,{children:"Yes"}),(0,t.jsx)(n.td,{children:"Unique name for the check"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"dataset"})}),(0,t.jsx)(n.td,{children:"Yes"}),(0,t.jsxs)(n.td,{children:["Must be ",(0,t.jsx)(n.code,{children:"metrics"})," (references historical data)"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"type"})}),(0,t.jsx)(n.td,{children:"Yes"}),(0,t.jsxs)(n.td,{children:["Must be ",(0,t.jsx)(n.code,{children:"anomaly"})]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"check_id"})}),(0,t.jsx)(n.td,{children:"Yes"}),(0,t.jsx)(n.td,{children:"ID of the metric to analyze for anomalies"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"condition"})}),(0,t.jsx)(n.td,{children:"Yes"}),(0,t.jsxs)(n.td,{children:["Usually ",(0,t.jsx)(n.code,{children:"between"})," for z-score bounds"]})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:(0,t.jsx)(n.code,{children:"threshold"})}),(0,t.jsx)(n.td,{children:"Yes"}),(0,t.jsx)(n.td,{children:"Z-score range (e.g., [-3.5, 3.5])"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"how-it-works",children:"How It Works"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Historical Data"}),": Analyzes past values from the metrics store"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"MAD Calculation"}),": Computes Median Absolute Deviation for robust statistics"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Z-Score"}),": Calculates modified z-score for the latest value"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Threshold Check"}),": Compares z-score against configured bounds"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"examples",children:"Examples"}),"\n",(0,t.jsx)(n.h3,{id:"basic-anomaly-detection",children:"Basic Anomaly Detection"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"- name: orders_anomaly_detection\n  dataset: metrics\n  type: anomaly\n  check_id: c5cee10898e30edd1c0dde3f24966b4c47890fcf247e5b630c2c156f7ac7ba22\n  condition: between\n  threshold: [-3.5, 3.5]\n"})}),"\n",(0,t.jsx)(n.p,{children:"This check detects anomalies in order count using 3.5 standard deviations."}),"\n",(0,t.jsx)(n.h3,{id:"strict-anomaly-detection",children:"Strict Anomaly Detection"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"- name: revenue_strict_anomaly\n  dataset: metrics\n  type: anomaly\n  check_id: abc123def456...\n  condition: between\n  threshold: [-2.0, 2.0]\n"})}),"\n",(0,t.jsx)(n.p,{children:"This uses tighter bounds (2 standard deviations) for more sensitive detection."}),"\n",(0,t.jsx)(n.h3,{id:"relaxed-anomaly-detection",children:"Relaxed Anomaly Detection"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"- name: user_activity_relaxed\n  dataset: metrics\n  type: anomaly\n  check_id: xyz789uvw012...\n  condition: between\n  threshold: [-5.0, 5.0]\n"})}),"\n",(0,t.jsx)(n.p,{children:"This uses wider bounds for less sensitive anomaly detection."}),"\n",(0,t.jsx)(n.h2,{id:"getting-check-ids",children:"Getting Check IDs"}),"\n",(0,t.jsxs)(n.p,{children:["To find the ",(0,t.jsx)(n.code,{children:"check_id"})," for your metrics:"]}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Run the check first"}),": Execute the underlying metric check"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Check logs"}),": The check ID is generated and logged"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Query metrics store"}),": Look in the metrics table for the check_id"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Generate manually"}),": Use the same hashing algorithm (SHA256)"]}),"\n"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sql",children:"-- Query to find check IDs\nSELECT DISTINCT check_id, check_name \nFROM metrics \nORDER BY run_time DESC;\n"})}),"\n",(0,t.jsx)(n.h2,{id:"statistical-method",children:"Statistical Method"}),"\n",(0,t.jsx)(n.h3,{id:"median-absolute-deviation-mad",children:"Median Absolute Deviation (MAD)"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"MAD = median(|xi - median(x)|)\n"})}),"\n",(0,t.jsx)(n.h3,{id:"modified-z-score",children:"Modified Z-Score"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"z-score = 0.6745 * (x - median) / MAD\n"})}),"\n",(0,t.jsx)(n.p,{children:"This method is more robust than standard deviation because it's less affected by outliers."}),"\n",(0,t.jsx)(n.h2,{id:"minimum-data-requirements",children:"Minimum Data Requirements"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Minimum 5 data points"})," required for statistical analysis"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Recommended 30+ points"})," for reliable anomaly detection"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Regular intervals"})," work best (daily, hourly, etc.)"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"use-cases",children:"Use Cases"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"System Monitoring"}),": Detect unusual system behavior"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Business Metrics"}),": Identify unexpected changes in KPIs"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Data Quality"}),": Find data pipeline issues"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Performance"}),": Monitor response times and error rates"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Security"}),": Detect unusual access patterns"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"example-results",children:"Example Results"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"\u2713 orders_anomaly_detection: z-score 1.2 (within [-3.5, 3.5])\n\u2717 revenue_strict_anomaly: z-score -2.8 (outside [-2.0, 2.0])\n\u2713 user_activity_relaxed: z-score 3.1 (within [-5.0, 5.0])\n"})}),"\n",(0,t.jsx)(n.h2,{id:"workflow-integration",children:"Workflow Integration"}),"\n",(0,t.jsx)(n.h3,{id:"step-1-set-up-base-metric",children:"Step 1: Set up base metric"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"- name: daily_order_count\n  dataset: orders\n  type: row_count\n  condition: gt\n  threshold: 0\n  time_dimension:\n    name: created_at\n    granularity: day\n"})}),"\n",(0,t.jsx)(n.h3,{id:"step-2-run-and-collect-data",children:"Step 2: Run and collect data"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"weiser run config.yaml\n"})}),"\n",(0,t.jsx)(n.h3,{id:"step-3-add-anomaly-detection",children:"Step 3: Add anomaly detection"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"- name: daily_order_count_anomaly\n  dataset: metrics\n  type: anomaly\n  check_id: <generated_check_id>\n  condition: between\n  threshold: [-3.0, 3.0]\n"})}),"\n",(0,t.jsx)(n.h2,{id:"threshold-guidelines",children:"Threshold Guidelines"}),"\n",(0,t.jsxs)(n.table,{children:[(0,t.jsx)(n.thead,{children:(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.th,{children:"Sensitivity"}),(0,t.jsx)(n.th,{children:"Z-Score Range"}),(0,t.jsx)(n.th,{children:"Use Case"})]})}),(0,t.jsxs)(n.tbody,{children:[(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Very Strict"}),(0,t.jsx)(n.td,{children:"[-1.5, 1.5]"}),(0,t.jsx)(n.td,{children:"Critical systems"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Strict"}),(0,t.jsx)(n.td,{children:"[-2.0, 2.0]"}),(0,t.jsx)(n.td,{children:"Important metrics"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Normal"}),(0,t.jsx)(n.td,{children:"[-3.0, 3.0]"}),(0,t.jsx)(n.td,{children:"Standard monitoring"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Relaxed"}),(0,t.jsx)(n.td,{children:"[-3.5, 3.5]"}),(0,t.jsx)(n.td,{children:"Noisy data"})]}),(0,t.jsxs)(n.tr,{children:[(0,t.jsx)(n.td,{children:"Very Relaxed"}),(0,t.jsx)(n.td,{children:"[-5.0, 5.0]"}),(0,t.jsx)(n.td,{children:"Exploratory analysis"})]})]})]}),"\n",(0,t.jsx)(n.h2,{id:"limitations",children:"Limitations"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Seasonal Data"}),": May not handle seasonal patterns well"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Trend Data"}),": Works best with stationary time series"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Small Datasets"}),": Requires sufficient historical data"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Sudden Changes"}),": May flag legitimate business changes as anomalies"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,t.jsxs)(n.ol,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Start Relaxed"}),": Begin with wider thresholds and tighten as needed"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Monitor Trends"}),": Consider detrending data for better results"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Regular Review"}),": Periodically review and adjust thresholds"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Context Matters"}),": Combine with business context for interpretation"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.strong,{children:"Multiple Metrics"}),": Use alongside other validation checks"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,t.jsx)(n.h3,{id:"insufficient-data",children:"Insufficient Data"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Error: Not enough historical data points (need at least 5)\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Solution"}),": Run base checks more frequently to build history"]}),"\n",(0,t.jsx)(n.h3,{id:"check-id-not-found",children:"Check ID Not Found"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{children:"Error: No data found for check_id: abc123...\n"})}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Solution"}),": Verify the check_id exists in metrics table"]}),"\n",(0,t.jsx)(n.h3,{id:"all-values-flagged",children:"All Values Flagged"}),"\n",(0,t.jsxs)(n.p,{children:[(0,t.jsx)(n.strong,{children:"Symptoms"}),": Every value detected as anomaly\n",(0,t.jsx)(n.strong,{children:"Solution"}),": Widen threshold range or check data quality"]}),"\n",(0,t.jsx)(n.h2,{id:"related-checks",children:"Related Checks"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/docs/check-types/row-count",children:(0,t.jsx)(n.strong,{children:"Row Count"})})," - Base metric for anomaly detection"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/docs/check-types/numeric",children:(0,t.jsx)(n.strong,{children:"Numeric"})})," - Custom metrics for anomaly analysis"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.a,{href:"/docs/check-types/sum",children:(0,t.jsx)(n.strong,{children:"Sum"})})," - Revenue/amount anomaly detection"]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(o,{...e})}):o(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>d,x:()=>r});var i=s(6540);const t={},l=i.createContext(t);function d(e){const n=i.useContext(l);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:d(e.components),i.createElement(l.Provider,{value:n},e.children)}}}]);